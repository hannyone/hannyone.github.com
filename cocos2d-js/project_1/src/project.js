require=function t(e,r,i){function c(l,o){if(!r[l]){if(!e[l]){var s="function"==typeof require&&require;if(!o&&s)return s(l,!0);if(n)return n(l,!0);var h=new Error("Cannot find module '"+l+"'");throw h.code="MODULE_NOT_FOUND",h}var d=r[l]={exports:{}};e[l][0].call(d.exports,function(t){var r=e[l][1][t];return c(r?r:t)},d,d.exports,t,e,r,i)}return r[l].exports}for(var n="function"==typeof require&&require,l=0;l<i.length;l++)c(i[l]);return c}({Main:[function(t,e,r){"use strict";cc._RFpush(e,"c3e3fhd2P9Al6wWyp5tYOhi","Main"),cc.Class({"extends":cc.Component,properties:{blockEdgeLength:60,fieldMapLRMargin:20,fieldMapTBMargin:30,blockTypeCount:7,fieldMapRow:15,fieldMapColumn:10,fieldMapText:{"default":null,type:cc.Object},fieldMapImage:{"default":null,type:cc.Node},Background:{"default":null,type:cc.Node},ArrowR:{"default":null,type:cc.Node},ArrowL:{"default":null,type:cc.Node},ArrowD:{"default":null,type:cc.Node},ArrowRU:{"default":null,type:cc.Node},ArrowLU:{"default":null,type:cc.Node},CurrentBlock:{"default":null,type:cc.Node},Block:{"default":null,type:cc.Prefab},BlockT:{"default":null,type:cc.Prefab},BlockI:{"default":null,type:cc.Prefab},BlockO:{"default":null,type:cc.Prefab},BlockL:{"default":null,type:cc.Prefab},BlockRL:{"default":null,type:cc.Prefab},BlockS:{"default":null,type:cc.Prefab},BlockRS:{"default":null,type:cc.Prefab}},onLoad:function(){var t=this;this.fieldMapText=[],this.fieldMapImage=[];for(var e=0;e<this.fieldMapRow+2;e++){this.fieldMapText.push([]),this.fieldMapImage.push([]);for(var r=0;r<this.fieldMapColumn+2;r++)0===e||e===this.fieldMapRow+1?this.fieldMapText[e].push(9):0===r||r===this.fieldMapColumn+1?this.fieldMapText[e].push(9):this.fieldMapText[e].push(0),this.fieldMapImage.push(),e>0&&e<this.fieldMapRow+1&&r>0&&r<this.fieldMapColumn+1&&(this.fieldMapImage[e][r]=cc.instantiate(this.Block),this.fieldMapImage[e][r].setPosition(cc.p((r-1)*this.blockEdgeLength+this.fieldMapLRMargin,(e-1)*this.blockEdgeLength+this.fieldMapTBMargin)))}this.ArrowR.on(cc.Node.EventType.TOUCH_START,function(e){t.moveRight()}),this.ArrowL.on(cc.Node.EventType.TOUCH_START,function(e){t.moveLeft()}),this.ArrowD.on(cc.Node.EventType.TOUCH_START,function(e){t.pullDownBlock(),t.unschedule(t.blockDownCallback),t.schedule(t.blockDownCallback,.09)}),this.ArrowD.on(cc.Node.EventType.TOUCH_END,function(e){t.unschedule(t.blockDownCallback),t.schedule(t.blockDownCallback,1)}),this.ArrowD.on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.unschedule(t.blockDownCallback),t.schedule(t.blockDownCallback,1)}),this.ArrowRU.on(cc.Node.EventType.TOUCH_START,function(e){t.rotateBlock("R")}),this.ArrowLU.on(cc.Node.EventType.TOUCH_START,function(e){t.rotateBlock("L")})},getBlockStartPosition:function(){return 1===this.currentBlockNum?cc.p(this.fieldMapLRMargin+this.blockEdgeLength*(this.fieldMapColumn/2),this.blockEdgeLength*this.fieldMapRow-this.fieldMapTBMargin):cc.p(this.fieldMapLRMargin+this.blockEdgeLength*(this.fieldMapColumn/2),this.blockEdgeLength*(this.fieldMapRow-1)-this.fieldMapTBMargin)},getBlockNum:function(){return Math.floor(Math.random()*this.blockTypeCount)+2},createBlockText:function(){switch(this.currentBlockNum=this.getBlockNum(),this.currentBlockNum){case 2:this.fieldMapText[15][5]=1,this.fieldMapText[14][4]=1,this.fieldMapText[14][5]=1,this.fieldMapText[14][6]=1,this.currentBlockCenterIdx=[14,5],this.currentBlockRotationMax=4;break;case 3:this.fieldMapText[15][3]=1,this.fieldMapText[15][4]=1,this.fieldMapText[15][5]=1,this.fieldMapText[15][6]=1,this.currentBlockCenterIdx=[15,4],this.currentBlockRotationMax=2;break;case 4:this.fieldMapText[15][5]=1,this.fieldMapText[15][6]=1,this.fieldMapText[14][5]=1,this.fieldMapText[14][6]=1,this.currentBlockCenterIdx=[15,5],this.currentBlockRotationMax=1;break;case 5:this.fieldMapText[15][6]=1,this.fieldMapText[14][4]=1,this.fieldMapText[14][5]=1,this.fieldMapText[14][6]=1,this.currentBlockCenterIdx=[15,5],this.currentBlockRotationMax=4;break;case 6:this.fieldMapText[15][4]=1,this.fieldMapText[14][4]=1,this.fieldMapText[14][5]=1,this.fieldMapText[14][6]=1,this.currentBlockCenterIdx=[15,5],this.currentBlockRotationMax=4;break;case 7:this.fieldMapText[15][5]=1,this.fieldMapText[15][6]=1,this.fieldMapText[14][4]=1,this.fieldMapText[14][5]=1,this.currentBlockCenterIdx=[14,5],this.currentBlockRotationMax=2;break;case 8:this.fieldMapText[15][4]=1,this.fieldMapText[15][5]=1,this.fieldMapText[14][5]=1,this.fieldMapText[14][6]=1,this.currentBlockCenterIdx=[14,5],this.currentBlockRotationMax=2}this.currentBlockRotationNum=1,this.drawBlocks(),console.log(this.fieldMapText)},drawBlocks:function(){for(var t=1;t<=this.fieldMapRow;t++)for(var e=1;e<=this.fieldMapColumn;e++)this.fieldMapText[t][e]>0?this.fieldMapImage[t][e].parent=cc.director.getScene():this.fieldMapImage[t][e].parent=null},start:function(){this.createBlockText(),this.schedule(this.blockDownCallback,1)},blockDownCallback:function(t){this.pullDownBlock()},pullDownBlock:function(){for(var t=!1,e=0,r=1;r<=this.fieldMapRow;r++){for(var i=1;i<=this.fieldMapColumn;i++)if(1===this.fieldMapText[r][i]){if(e++,this.fieldMapText[r-1][i]>1){t=!0;break}if(4===e)break}if(4===e)break}e=0;for(var r=1;r<=this.fieldMapRow;r++){for(var i=1;i<=this.fieldMapColumn&&(1!==this.fieldMapText[r][i]||(e++,t?this.fieldMapText[r][i]=this.currentBlockNum:(this.fieldMapText[r][i]=0,this.fieldMapText[r-1][i]=1),4!==e));i++);if(4===e)break}t?this.createBlockText():(this.currentBlockCenterIdx[0]--,this.drawBlocks())},moveLeft:function(){for(var t=!1,e=0,r=1;r<=this.fieldMapRow;r++){for(var i=1;i<=this.fieldMapColumn;i++)if(1===this.fieldMapText[r][i]){if(e++,this.fieldMapText[r][i-1]>1){t=!0;break}if(4===e)break}if(4===e)break}e=0;for(var r=1;r<=this.fieldMapRow;r++){for(var i=1;i<=this.fieldMapColumn&&(1!==this.fieldMapText[r][i]||(e++,t||(this.fieldMapText[r][i]=0,this.fieldMapText[r][i-1]=1),4!==e));i++);if(4===e)break}t||(this.currentBlockCenterIdx[1]--,this.drawBlocks())},moveRight:function(){for(var t=!1,e=0,r=1;r<=this.fieldMapRow;r++){for(var i=this.fieldMapColumn;i>=1;i--)if(1===this.fieldMapText[r][i]){if(e++,this.fieldMapText[r][i+1]>1){t=!0;break}if(4===e)break}if(4===e)break}e=0;for(var r=1;r<=this.fieldMapRow;r++){for(var i=this.fieldMapColumn;i>=1&&(1!==this.fieldMapText[r][i]||(e++,t||(this.fieldMapText[r][i]=0,this.fieldMapText[r][i+1]=1),4!==e));i--);if(4===e)break}t||(this.currentBlockCenterIdx[1]++,this.drawBlocks())},rotateBlock:function(t){switch("L"===t?this.currentBlockRotationNum>1?this.currentBlockRotationNum--:this.currentBlockRotationNum=this.currentBlockRotationMax:"R"===t&&(this.currentBlockRotationNum<this.currentBlockRotationMax?this.currentBlockRotationNum++:this.currentBlockRotationNum=1),this.currentBlockNum){case 2:for(var e=this.currentBlockCenterIdx[0]-1;e<=this.currentBlockCenterIdx[0]+1;e++)for(var r=this.currentBlockCenterIdx[1]-1;r<=this.currentBlockCenterIdx[1]+1;r++)1===this.fieldMapText[e][r]&&(this.fieldMapText[e][r]=0);1===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1):2===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]]=1):3===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]]=1):4===this.currentBlockRotationNum&&(this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]]=1);break;case 3:for(var e=this.currentBlockCenterIdx[0]-1;e<=this.currentBlockCenterIdx[0]+2;e++)for(var r=this.currentBlockCenterIdx[1]-1;r<=this.currentBlockCenterIdx[1]+2;r++)1===this.fieldMapText[e][r]&&(this.fieldMapText[e][r]=0);1===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+2]=1):2===this.currentBlockRotationNum&&(this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+2][this.currentBlockCenterIdx[1]]=1);break;case 4:return;case 5:for(var e=this.currentBlockCenterIdx[0]-1;e<=this.currentBlockCenterIdx[0]+1;e++)for(var r=this.currentBlockCenterIdx[1]-1;r<=this.currentBlockCenterIdx[1]+1;r++)1===this.fieldMapText[e][r]&&(this.fieldMapText[e][r]=0);1===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]+1]=1):2===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]]=1):3===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]+1]=1):4===this.currentBlockRotationNum&&(this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]+1]=1);break;case 6:for(var e=this.currentBlockCenterIdx[0]-1;e<=this.currentBlockCenterIdx[0]+1;e++)for(var r=this.currentBlockCenterIdx[1]-1;r<=this.currentBlockCenterIdx[1]+1;r++)1===this.fieldMapText[e][r]&&(this.fieldMapText[e][r]=0);1===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]+1]=1):2===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1):3===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1):4===this.currentBlockRotationNum&&(this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]]=1);break;case 7:for(var e=this.currentBlockCenterIdx[0]-1;e<=this.currentBlockCenterIdx[0]+2;e++)for(var r=this.currentBlockCenterIdx[1]-1;r<=this.currentBlockCenterIdx[1]+2;r++)1===this.fieldMapText[e][r]&&(this.fieldMapText[e][r]=0);1===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]+1]=1):2===this.currentBlockRotationNum&&(this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]+1]=1);break;case 8:for(var e=this.currentBlockCenterIdx[0]-1;e<=this.currentBlockCenterIdx[0]+2;e++)for(var r=this.currentBlockCenterIdx[1]-1;r<=this.currentBlockCenterIdx[1]+2;r++)1===this.fieldMapText[e][r]&&(this.fieldMapText[e][r]=0);1===this.currentBlockRotationNum?(this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]-1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1):2===this.currentBlockRotationNum&&(this.fieldMapText[this.currentBlockCenterIdx[0]-1][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]]=1,this.fieldMapText[this.currentBlockCenterIdx[0]][this.currentBlockCenterIdx[1]+1]=1,this.fieldMapText[this.currentBlockCenterIdx[0]+1][this.currentBlockCenterIdx[1]+1]=1)}this.drawBlocks()}}),cc._RFpop()},{}]},{},["Main"]);
//# sourceMappingURL=project.js.map
require=function t(e,r,i){function o(n,c){if(!r[n]){if(!e[n]){var h="function"==typeof require&&require;if(!c&&h)return h(n,!0);if(l)return l(n,!0);var s=new Error("Cannot find module '"+n+"'");throw s.code="MODULE_NOT_FOUND",s}var u=r[n]={exports:{}};e[n][0].call(u.exports,function(t){var r=e[n][1][t];return o(r?r:t)},u,u.exports,t,e,r,i)}return r[n].exports}for(var l="function"==typeof require&&require,n=0;n<i.length;n++)o(i[n]);return o}({Main:[function(t,e,r){"use strict";cc._RFpush(e,"c3e3fhd2P9Al6wWyp5tYOhi","Main"),cc.Class({"extends":cc.Component,properties:{blockEdgeLength:60,fieldMapLRMargin:20,fieldMapTBMargin:40,blockTypeCount:7,fieldMapRow:20,fieldMapColumn:10,fieldMapText:{"default":null,type:cc.Object},fieldMapImage:{"default":null,type:cc.Node},Background:{"default":null,type:cc.Node},ArrowR:{"default":null,type:cc.Node},ArrowL:{"default":null,type:cc.Node},ArrowD:{"default":null,type:cc.Node},ArrowRU:{"default":null,type:cc.Node},ArrowLU:{"default":null,type:cc.Node},Block:{"default":null,type:cc.Prefab},BlockT:{"default":null,type:cc.Prefab},BlockI:{"default":null,type:cc.Prefab},BlockO:{"default":null,type:cc.Prefab},BlockL:{"default":null,type:cc.Prefab},BlockRL:{"default":null,type:cc.Prefab},BlockS:{"default":null,type:cc.Prefab},BlockRS:{"default":null,type:cc.Prefab},ScoreValue:{"default":null,type:cc.Label}},onLoad:function(){var t=this;this.fieldMapText=[],this.fieldMapImage=[];for(var e=0;e<this.fieldMapRow+2;e++){this.fieldMapText.push([]),this.fieldMapImage.push([]);for(var r=0;r<this.fieldMapColumn+2;r++)0===e||e===this.fieldMapRow+1?this.fieldMapText[e].push(9):0===r||r===this.fieldMapColumn+1?this.fieldMapText[e].push(9):this.fieldMapText[e].push(0),this.fieldMapImage.push(),e>0&&e<this.fieldMapRow+1&&r>0&&r<this.fieldMapColumn+1&&(this.fieldMapImage[e][r]=cc.instantiate(this.Block),this.fieldMapImage[e][r].setPosition(cc.p((r-1)*this.blockEdgeLength+this.fieldMapLRMargin,(e-1)*this.blockEdgeLength+this.fieldMapTBMargin)),this.fieldMapImage[e][r].opacity=200)}this.CurrentBlock=[];for(var e=0;e<4;e++)this.CurrentBlock.push();this.ArrowR.on(cc.Node.EventType.TOUCH_START,function(e){t.moveRight()}),this.ArrowL.on(cc.Node.EventType.TOUCH_START,function(e){t.moveLeft()}),this.ArrowD.on(cc.Node.EventType.TOUCH_START,function(e){t.pullDownBlock(),t.unschedule(t.blockDownCallback),t.schedule(t.blockDownCallback,.09)}),this.ArrowD.on(cc.Node.EventType.TOUCH_END,function(e){t.unschedule(t.blockDownCallback),t.schedule(t.blockDownCallback,1)}),this.ArrowD.on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.unschedule(t.blockDownCallback),t.schedule(t.blockDownCallback,1)}),this.ArrowRU.on(cc.Node.EventType.TOUCH_START,function(e){t.rotateBlock("R")}),this.ArrowLU.on(cc.Node.EventType.TOUCH_START,function(e){t.rotateBlock("R")})},getBlockStartPosition:function(){return 1===this.currentBlockNum?cc.p(this.fieldMapLRMargin+this.blockEdgeLength*(this.fieldMapColumn/2),this.blockEdgeLength*this.fieldMapRow-this.fieldMapTBMargin):cc.p(this.fieldMapLRMargin+this.blockEdgeLength*(this.fieldMapColumn/2),this.blockEdgeLength*(this.fieldMapRow-1)-this.fieldMapTBMargin)},getBlockNum:function(){return Math.floor(Math.random()*this.blockTypeCount)+2},createBlockText:function(){switch(this.currentBlockNum=this.getBlockNum(),this.currentBlockNum){case 2:this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)-1]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)+1]=1,this.currentBlockCenterIdx=[this.fieldMapRow-1,Math.floor(this.fieldMapColumn/2)],this.currentBlockRotationMax=4;break;case 3:this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)-1]=1,this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)]=1,this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)+1]=1,this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)+2]=1,this.currentBlockCenterIdx=[this.fieldMapRow,Math.floor(this.fieldMapColumn/2)],this.currentBlockRotationMax=2;break;case 4:this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)]=1,this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)+1]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)+1]=1,this.currentBlockCenterIdx=[this.fieldMapRow,Math.floor(this.fieldMapColumn/2)],this.currentBlockRotationMax=1;break;case 5:this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)+1]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)-1]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)+1]=1,this.currentBlockCenterIdx=[this.fieldMapRow,Math.floor(this.fieldMapColumn/2)],this.currentBlockRotationMax=4;break;case 6:this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)-1]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)-1]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)+1]=1,this.currentBlockCenterIdx=[this.fieldMapRow,Math.floor(this.fieldMapColumn/2)],this.currentBlockRotationMax=4;break;case 7:this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)]=1,this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)+1]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)-1]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)]=1,this.currentBlockCenterIdx=[this.fieldMapRow-1,Math.floor(this.fieldMapColumn/2)],this.currentBlockRotationMax=2;break;case 8:this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)-1]=1,this.fieldMapText[this.fieldMapRow][Math.floor(this.fieldMapColumn/2)]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)]=1,this.fieldMapText[this.fieldMapRow-1][Math.floor(this.fieldMapColumn/2)+1]=1,this.currentBlockCenterIdx=[this.fieldMapRow-1,Math.floor(this.fieldMapColumn/2)],this.currentBlockRotationMax=2}this.currentBlockRotationNum=1,this.drawBlocks()},drawBlocks:function(){for(var t=1;t<=this.fieldMapRow;t++)for(var e=1;e<=this.fieldMapColumn;e++)this.fieldMapText[t][e]>0?this.fieldMapImage[t][e].parent=cc.director.getScene():this.fieldMapImage[t][e].parent=null},start:function(){this.createBlockText(),this.schedule(this.blockDownCallback,1)},checkFullLine:function(){for(var t,e=[null],r=0,i=1;i<=this.fieldMapRow;i++){t=0;for(var o=1;o<=this.fieldMapColumn;o++)this.fieldMapText[i][o]>1&&t++;if(t===this.fieldMapColumn){e.push(!0),this.ScoreValue.string=Number(this.ScoreValue.string+1);for(var o=1;o<=this.fieldMapColumn;o++)this.fieldMapText[i][o]=0}else e.push(!1)}for(var i=1;i<=this.fieldMapRow;i++)if(e[i])r++;else if(0!==r)for(var o=1;o<=this.fieldMapColumn;o++)this.fieldMapText[i-r][o]=this.fieldMapText[i][o],this.fieldMapText[i][o]=0},blockDownCallback:function(t){this.pullDownBlock()},pullDownBlock:function(){for(var t=!1,e=0,r=1;r<=this.fieldMapRow;r++){for(var i=1;i<=this.fieldMapColumn;i++)if(1===this.fieldMapText[r][i]){if(e++,this.fieldMapText[r-1][i]>1){t=!0;break}if(4===e)break}if(4===e)break}e=0;for(var r=1;r<=this.fieldMapRow;r++){for(var i=1;i<=this.fieldMapColumn&&(1!==this.fieldMapText[r][i]||(e++,t?this.fieldMapText[r][i]=this.currentBlockNum:(this.fieldMapText[r][i]=0,this.fieldMapText[r-1][i]=1),4!==e));i++);if(4===e)break}t?(this.checkFullLine(),this.createBlockText()):(this.currentBlockCenterIdx[0]--,this.drawBlocks())},moveLeft:function(){for(var t=!1,e=0,r=1;r<=this.fieldMapRow;r++){for(var i=1;i<=this.fieldMapColumn;i++)if(1===this.fieldMapText[r][i]){if(e++,this.fieldMapText[r][i-1]>1){t=!0;break}if(4===e)break}if(4===e)break}e=0;for(var r=1;r<=this.fieldMapRow;r++){for(var i=1;i<=this.fieldMapColumn&&(1!==this.fieldMapText[r][i]||(e++,t||(this.fieldMapText[r][i]=0,this.fieldMapText[r][i-1]=1),4!==e));i++);if(4===e)break}t||(this.currentBlockCenterIdx[1]--,this.drawBlocks())},moveRight:function(){for(var t=!1,e=0,r=1;r<=this.fieldMapRow;r++){for(var i=this.fieldMapColumn;i>=1;i--)if(1===this.fieldMapText[r][i]){if(e++,this.fieldMapText[r][i+1]>1){t=!0;break}if(4===e)break}if(4===e)break}e=0;for(var r=1;r<=this.fieldMapRow;r++){for(var i=this.fieldMapColumn;i>=1&&(1!==this.fieldMapText[r][i]||(e++,t||(this.fieldMapText[r][i]=0,this.fieldMapText[r][i+1]=1),4!==e));i--);if(4===e)break}t||(this.currentBlockCenterIdx[1]++,this.drawBlocks())},rotateBlock:function(t){switch("L"===t?this.currentBlockRotationNum>1?this.currentBlockRotationNum--:this.currentBlockRotationNum=this.currentBlockRotationMax:"R"===t&&(this.currentBlockRotationNum<this.currentBlockRotationMax?this.currentBlockRotationNum++:this.currentBlockRotationNum=1),this.currentBlockNum){case 2:1===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]+1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]}):2===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]+1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1}):3===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1}):4===this.currentBlockRotationNum&&(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]+1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1});break;case 3:1===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+2,y:this.currentBlockCenterIdx[0]}):2===this.currentBlockRotationNum&&(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]+1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-2});break;case 4:return;case 5:1===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]}):2===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]+1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]-1}):3===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+2,y:this.currentBlockCenterIdx[0]}):4===this.currentBlockRotationNum&&(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]-2});break;case 6:1===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]-1}):2===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]-2},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]}):3===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1]-2,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1}):4===this.currentBlockRotationNum&&(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]+1});break;case 7:1===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]+1},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]+1}):2===this.currentBlockRotationNum&&(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]+1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]-1});break;case 8:1===this.currentBlockRotationNum?(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1]-1,y:this.currentBlockCenterIdx[0]+1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]+1},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]}):2===this.currentBlockRotationNum&&(this.CurrentBlock[0]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]-1},this.CurrentBlock[1]={x:this.currentBlockCenterIdx[1],y:this.currentBlockCenterIdx[0]},this.CurrentBlock[2]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]},this.CurrentBlock[3]={x:this.currentBlockCenterIdx[1]+1,y:this.currentBlockCenterIdx[0]+1})}for(var e=0;e<4;e++)if(this.fieldMapText[this.CurrentBlock[e].y][this.CurrentBlock[e].x]>1)return void("L"===t?this.currentBlockRotationNum<this.currentBlockRotationMax?this.currentBlockRotationNum++:this.currentBlockRotationNum=1:"R"===t&&(this.currentBlockRotationNum>1?this.currentBlockRotationNum--:this.currentBlockRotationNum=this.currentBlockRotationMax));for(var e=this.currentBlockCenterIdx[0]-2;e<=this.currentBlockCenterIdx[0]+2;e++)for(var r=this.currentBlockCenterIdx[1]-2;r<=this.currentBlockCenterIdx[1]+2;r++)e>=0&&e<this.fieldMapRow+2&&r>=0&&r<this.fieldMapColumn+2&&1===this.fieldMapText[e][r]&&(this.fieldMapText[e][r]=0);for(var e=0;e<4;e++)this.fieldMapText[this.CurrentBlock[e].y][this.CurrentBlock[e].x]=1;this.drawBlocks()}}),cc._RFpop()},{}]},{},["Main"]);
//# sourceMappingURL=project.js.map